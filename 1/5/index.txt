3:I[4707,[],""]
6:I[6423,[],""]
7:I[2798,["185","static/chunks/app/layout-c0991f7d76273a13.js"],"ThemeProvider"]
8:I[9734,["185","static/chunks/app/layout-c0991f7d76273a13.js"],"DynamicFavicon"]
9:I[8291,["185","static/chunks/app/layout-c0991f7d76273a13.js"],"Analytics"]
4:["month","1","d"]
5:["day","5","d"]
0:["VQoYmXv-G56ZgJRRzJJFi",[[["",{"children":[["month","1","d"],{"children":[["day","5","d"],{"children":["__PAGE__?{\"month\":\"1\",\"day\":\"5\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":[["month","1","d"],{"children":[["day","5","d"],{"children":["__PAGE__",{},[["$L1","$L2",null],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children","$5","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/2025/_next/static/css/df8c932e539912be.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"className":"h-full","children":["$","body",null,{"className":"min-h-full bg-white dark:bg-black","children":[["$","$L7",null,{"children":["$","div",null,{"className":"flex flex-col min-h-full","children":[["$","$L8",null,{}],["$","div",null,{"className":"flex-1 w-full","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[]}]}],["$","footer",null,{"className":"text-center text-sm text-gray-600 dark:text-gray-400 py-4 bg-white dark:bg-black","children":["© ",2025," Michael Pilosov. All rights reserved."]}]]}]}],["$","$L9",null,{}]]}]}]],null],null],["$La",null]]]]
b:I[2972,["450","static/chunks/450-fc8431448c3438bc.js","878","static/chunks/878-5d3156bd3161bc5d.js","160","static/chunks/app/%5Bmonth%5D/%5Bday%5D/page-475f15d3cd396c50.js"],""]
c:I[1190,["450","static/chunks/450-fc8431448c3438bc.js","878","static/chunks/878-5d3156bd3161bc5d.js","160","static/chunks/app/%5Bmonth%5D/%5Bday%5D/page-475f15d3cd396c50.js"],"ThemeToggle"]
d:I[5878,["450","static/chunks/450-fc8431448c3438bc.js","878","static/chunks/878-5d3156bd3161bc5d.js","160","static/chunks/app/%5Bmonth%5D/%5Bday%5D/page-475f15d3cd396c50.js"],"Image"]
2:["$","div",null,{"className":"min-h-screen bg-white dark:bg-black text-black dark:text-white","children":[["$","header",null,{"className":"flex justify-between items-center mb-8 px-4","children":[["$","$Lb",null,{"href":"/","className":"text-2xl font-bold hover:underline","children":"2025 (12 Events)"}],["$","div",null,{"className":"flex items-center","children":[["$","$Lb",null,{"href":"/about","className":"hover:underline mr-4","children":"About"}],["$","$Lc",null,{}]]}]]}],["$","nav",null,{"className":"flex justify-between w-full mb-8 text-3xl font-bold text-gray-600 dark:text-gray-400 px-4","children":[["$","div",null,{"className":"flex-1 flex justify-start","children":["$","$Lb",null,{"href":"/1/4","className":"hover:underline","children":"←"}]}],["$","div",null,{"className":"flex-1 flex justify-end","children":["$","$Lb",null,{"href":"/1/6","className":"hover:underline","children":"→"}]}]]}],["$","main",null,{"children":["$","div",null,{"className":"max-w-content mx-auto px-4","children":["$","article",null,{"children":[["$","h1",null,{"className":"text-3xl font-bold mb-2","children":"An API for Kosmos-2"}],["$","p",null,{"className":"text-gray-600 dark:text-gray-400 mb-4","children":"2025-01-05"}],["$","div",null,{"className":"prose dark:prose-invert mb-8 [&>p]:mb-4 [&_a]:underline [&_a:hover]:text-gray-600 dark:[&_a:hover]:text-gray-300 [&>ul]:list-disc [&>ul]:pl-6 [&>ul]:mb-4 [&>ul>li]:pl-2","children":[["$","h2","0",{"children":"Introduction"}],"\n",["$","p","2",{"children":"Now that I have a working API and need to increase the number of frames that I can process per second, this post will go through the process of “productionalizing” Kosmos-2."}],"\n",["$","p","4",{"children":"The principles highlighted here will be pretty easy to generalize to other models; as you’ll see, the abstractions are fairly straightforward.\nThe hardest part is setting up the structure of inputs/outputs and the client-side process of sending images to the server."}],"\n",["$","p","6",{"children":"\n"}],["$","div","7",{"className":"flex justify-center","children":["\n        ",["$","a","1",{"href":"https://github.com/mindthemath/kosmos2-api","className":"inline-block px-4 py-2 bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 rounded-md text-lg transition-colors","children":"\n          tldr; source code for the technically inclined\n        "}],"\n      "]}],["$","p","8",{"children":"$undefined"}],"\n",["$","h2","10",{"children":"Context"}],"\n",["$","p","12",{"children":["If you didn’t read ",["$","a","1",{"href":"/1/1/","children":"the first post on this model"}],", here’s a summary of the model:"]}],"\n",["$","ul","14",{"children":["\n",["$","li","1",{"children":"Kosmos-2 is a Multimodal Large Language Model (MLLM) that enables new capabilities of perceiving object descriptions (e.g., bounding boxes) and grounding text to the visual world."}],"\n",["$","li","3",{"children":"It represents refer expressions as links in Markdown, using the format [text span](bounding boxes), where object descriptions are sequences of location tokens."}],"\n",["$","li","5",{"children":"Requires a GPU; so far it’s unclear which one is best optimized for inference but I am laying the groundwork to test this out."}],"\n"]}],"\n",["$","h2","16",{"children":"API"}],"\n",["$","p","18",{"children":"What I have done is convert this model into an API and published a Docker image that you can access with this button:"}],"\n",["$","p","20",{"children":["$","a",null,{"href":"https://hub.docker.com/r/mindthemath/kosmos2-api/tags","children":["$","$Ld",null,{"src":"https://img.shields.io/docker/v/mindthemath/kosmos2-api/latest","alt":"Docker Image","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}]}]}],"\n",["$","p","22",{"children":["Currently it is only built against the ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"nvidia/cuda:12.2.2-base-ubuntu22.04"}]," base image, but I will be adding support for other base images if someone asks."]}],"\n",["$","p","24",{"children":"It is started with the following command:"}],"\n",["$","div","26",{"className":"mb-4","children":["$","div",null,{"className":"bg-neutral-100 dark:bg-neutral-800 rounded-md font-mono","children":["$","pre",null,{"style":{"background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1rem","margin":0,"overflow":"auto","borderRadius":"0.3em","fontSize":"0.75rem"},"children":["$","code",null,{"className":"language-bash","style":{"whiteSpace":"pre","background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["docker"]}],["$","span","code-segment-1-1",{"className":"$undefined","style":{},"children":[" run --rm -ti -p "]}],["$","span","code-segment-1-2",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["8000"]}],["$","span","code-segment-1-3",{"className":"$undefined","style":{},"children":[":8000 mindthemath/kosmos2-api:latest\n"]}]]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":[""]}]]]}]}]}]}],"\n",["$","p","28",{"children":"When it starts up, it will download the model from HuggingFace Hub and save it to the container’s file-system, which will not persist after the container is stopped."}],"\n",["$","p","30",{"children":"Example usage:"}],"\n",["$","div","32",{"className":"mb-4","children":["$","div",null,{"className":"bg-neutral-100 dark:bg-neutral-800 rounded-md font-mono","children":["$","pre",null,{"style":{"background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1rem","margin":0,"overflow":"auto","borderRadius":"0.3em","fontSize":"0.75rem"},"children":["$","code",null,{"className":"language-bash","style":{"whiteSpace":"pre","background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["curl"]}],["$","span","code-segment-1-1",{"className":"$undefined","style":{},"children":[" -X POST -F "]}],["$","span","code-segment-1-2",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["\"content=@snowman.png\""]}],["$","span","code-segment-1-3",{"className":"$undefined","style":{},"children":[" http://127.0.0.1:8000/predict "]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["|"]}],["$","span","code-segment-1-5",{"className":"$undefined","style":{},"children":[" jq "]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["'.output'"]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":[""]}]]]}]}]}]}],"\n",["$","p","34",{"children":"For persistence, mount a volume to the container at the HuggingFace Hub cache directory:"}],"\n",["$","div","36",{"className":"mb-4","children":["$","div",null,{"className":"bg-neutral-100 dark:bg-neutral-800 rounded-md font-mono","children":["$","pre",null,{"style":{"background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1rem","margin":0,"overflow":"auto","borderRadius":"0.3em","fontSize":"0.75rem"},"children":["$","code",null,{"className":"language-bash","style":{"whiteSpace":"pre","background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["docker"]}],["$","span","code-segment-1-1",{"className":"$undefined","style":{},"children":[" run --rm -ti -p "]}],["$","span","code-segment-1-2",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["8000"]}],["$","span","code-segment-1-3",{"className":"$undefined","style":{},"children":[":8000 -v "]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["$$("]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["pwd"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":[")"]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":["/hub:/root/.cache/huggingface/hub mindthemath/kosmos2-api:latest\n"]}]]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":[""]}]]]}]}]}]}],"\n",["$","p","38",{"children":["The API was built with ",["$","a","1",{"href":"https://github.com/lightning-ai/litserve","children":["$","code",null,{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"litserve"}]}]," which uses ",["$","a","3",{"href":"https://www.uvicorn.org/","children":["$","code",null,{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"uvicorn"}]}]," (ASGI server) and ",["$","a","5",{"href":"https://fastapi.tiangolo.com/","children":["$","code",null,{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"FastAPI"}]}]," under the hood."]}],"\n",["$","p","40",{"children":["The ",["$","a","1",{"href":"https://github.com/mindthemath/kosmos2-api","children":"repository"}]," contains the scripts I used for creating the movies on ",["$","a","3",{"href":"/1/1/","children":"1/1"}]," and ",["$","a","5",{"href":"/1/2/","children":"1/2"}],"."]}],"\n",["$","p","42",{"children":"This first docker image isn’t perfectly cleaned up but it works great."}],"\n",["$","p","44",{"children":["The API takes in ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"content"}]," and an optional ",["$","code","3",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"prompt"}]," parameter:"]}],"\n",["$","div","46",{"className":"mb-4","children":["$","div",null,{"className":"bg-neutral-100 dark:bg-neutral-800 rounded-md font-mono","children":["$","pre",null,{"style":{"background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1rem","margin":0,"overflow":"auto","borderRadius":"0.3em","fontSize":"0.75rem"},"children":["$","code",null,{"className":"language-bash","style":{"whiteSpace":"pre","background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["curl"]}],["$","span","code-segment-1-1",{"className":"$undefined","style":{},"children":[" -X POST -F "]}],["$","span","code-segment-1-2",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["\"content=@snowman.png\""]}],["$","span","code-segment-1-3",{"className":"$undefined","style":{},"children":[" -F "]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["\"prompt=What is the snowman doing?\""]}],["$","span","code-segment-1-5",{"className":"$undefined","style":{},"children":[" http://127.0.0.1:8000/predict "]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["|"]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" jq "]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["'.output'"]}],["$","span","code-segment-1-9",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":[""]}]]]}]}]}]}],"\n",["$","h2","48",{"children":"Load Testing"}],"\n",["$","h3","50",{"children":"A Flood of Requests"}],"\n",["$","p","52",{"children":["I had to write some new code to hit the API with a lot of requests at once.\nI chose to try ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"ray"}]," decorators to parallelize the requests instead of simple ",["$","code","3",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"ThreadPoolExecutor"}]," because I had never used it before and wanted to see if it was any faster."]}],"\n",["$","p","54",{"children":"The jury’s out on this one, but I was able to send over 30 frames per second to the API by using 40 concurrent processes, and just left it there for the time being.\n(To be revisited…)"}],"\n",["$","p","56",{"children":["For a real video-processing pipeline, I would need to use some other tool that was better tailored to frame buffering and processing, and it’s been a while since I’ve played with this part of it (can ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"ffmpeg"}]," be enough?)."]}],"\n",["$","h3","58",{"children":"Choosing a GPU"}],"\n",["$","p","60",{"children":["I did some tests locally on my ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"NVIDIA RTX 3090"}]," and struggled to achieve higher than 3 frames per second (FPS).\nThis set a baseline, and allowed me to understand the memory requirements of the model (about 8GB).\nI was able to run 2 concurrent API servers on this GPU, but it was pinned to 100% GPU usage the whole time, so despite the memory headroom, the process was limited by the TFLops (tensor floating-point operations per second), of the GPU.\nArmed with my published docker image, it was time to move to the cloud."]}],"\n",["$","p","62",{"children":["First up was the ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"T4"}]," GPU from NVIDIA, courtesy of Lightning AI, which provided the infrastructure to run this on AWS by clicking on a button in their UI.\nI wasn’t able to get performance gains even close to what I was seeing on my ",["$","code","3",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"RTX 3090"}],", so I made a radical jump to the ",["$","code","5",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"L40S"}],", which is a new NVIDIA GPU optimized for inference (specifically in 16-bit floating-point arithmetic)."]}],"\n",["$","p","64",{"children":"Doing some testing on this, I found it to perform a bit better than my GPU at home, and could reliably hit above 3FPS but could not run more than 2 concurrent API servers despite having a lot of extra memory available because of the 100% GPU utilization."}],"\n",["$","h3","66",{"children":"Scaling"}],"\n",["$","p","68",{"children":"There were quite a few “knobs to play with” in this experiment, which was quite time-consuming."}],"\n",["$","p","70",{"children":"A non-exhaustive list of choices that I had to make:"}],"\n",["$","ul","72",{"children":["\n",["$","li","1",{"children":"which GPU to use: T4, L4, L40S, A10G, … H100?"}],"\n",["$","li","3",{"children":"number of GPUs per instance? (stuck with 1 for now)"}],"\n",["$","li","5",{"children":"size of the image - I found that 1/3 of the iPhone resolution was pretty similar to the original resolution but several dozen ms faster to process."}],"\n",["$","li","7",{"children":"number of API servers per machine - depends on GPU"}],"\n",["$","li","9",{"children":"batch size (stuck with 1 for now because of dropped frames when using higher values  - probably a bug on my client-side code)"}],"\n",["$","li","11",{"children":"client-side concurrency - how many threads / simultaneous requests to the API can my computer reasonably send?"}],"\n",["$","li","13",{"children":["scope - Am I testing the end-to-end pipeline (",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"frame -> json -> frame"}],"), or just ",["$","code","3",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"frame -> json"}],"? (I went back and forth, focused on the former)"]}],"\n"]}],"\n",["$","p","74",{"children":"I made some rapid choices and moved on to remote testing with Lightning AI’s deployment product that let me take my docker image and deploy it on many GPUs, handling load-balancing and resrouce monitoring for me."}],"\n",["$","h3","76",{"children":"Preliminary Results"}],"\n",["$","p","78",{"children":"Some initial benchmarks on my own machine:"}],"\n",["$","p","80",{"children":"\n"}],["$","figure","81",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/local.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Local testing on my RTX 3090"}],"\n      "]}],["$","p","82",{"children":"$undefined"}],"\n",["$","p","84",{"children":"Before moving to the cloud…"}],"\n",["$","p","86",{"children":"\n"}],["$","figure","87",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/first_cloud.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"First cloud testing on a single L40S GPU"}],"\n      "]}],["$","p","88",{"children":"$undefined"}],"\n",["$","p","90",{"children":["On the ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"L40S"}]," GPU, I was able to get ~3-5 FPS reliably with 2 concurrent API servers, depending on whether I was generating and saving the frames to disk as part of each request."]}],"\n",["$","blockquote","92",{"children":["\n",["$","p","1",{"children":"Side-note: I think Prefect may be a good tool to use because it makes async-programming (the generation of the frame locally should not block the next request)."}],"\n"]}],"\n",["$","p","94",{"children":"\n"}],["$","figure","95",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/remote_16fps.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Single L40S GPU with 3 concurrent API servers"}],"\n      "]}],["$","p","96",{"children":"$undefined"}],"\n",["$","p","98",{"children":"My napkin-math told me I’d need 10 GPUs to handle this, but I spent too much time scaling up slowly (I’ll spare you the details)."}],"\n",["$","p","100",{"children":"\n"}],["$","figure","101",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/remote_27fps.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"9 L40S GPUs with 2 concurrent API servers each"}],"\n      "]}],["$","p","102",{"children":"$undefined"}],"\n",["$","p","104",{"children":"Almost there… once I hit 10 concurrent GPUs I managed to finally see some promising results."}],"\n",["$","p","106",{"children":"\n"}],["$","figure","107",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/remote_29fps.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Achieving close to 30 FPS when using 10 GPUs"}],"\n      "]}],["$","p","108",{"children":"$undefined"}],"\n",["$","p","110",{"children":"Turning off the local image processing (creating the frame for the movie) allowed me to squeeze out those additional couple frames per second.\nAll of these tests were from my home server acting as client, and I’m certain that a more powerful machine would have less of a computational bottle-neck."}],"\n",["$","p","112",{"children":"\n"}],["$","figure","113",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/remote_31fps.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Real-time processing with 10 GPUs, but skipping local frame generation"}],"\n      "]}],["$","p","114",{"children":"$undefined"}],"\n",["$","p","116",{"children":"Eleven GPUs (and possibly more threads client-side) would almost certainly be able to process 30 FPS including generating the frames locally to have them ready for animation."}],"\n",["$","p","118",{"children":"\n"}],["$","figure","119",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/2025/1/4/cloud_cost.jpg?v","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Total cost of scaling experiments was under $20 using Spot Instances"}],"\n      "]}],["$","p","120",{"children":"$undefined"}],"\n",["$","p","122",{"children":["I used the Aquarium video from ",["$","a","1",{"href":"/1/1","children":"1/1"}]," for testing as it was the longest one I had, but here’s a different output for variety’s sake:"]}],"\n",["$","p","124",{"children":"\n"}],["$","figure","125",{"children":["\n        ",["$","video","1",{"controls":true,"children":["\n          ",["$","source","1",{"src":"https://cdn.math.computer/v/kosmos2/stripes/input.mov","type":"video/mp4","children":"$undefined"}],"\n          Your browser does not support the video tag.\n        "]}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"White Stripes - The Hardest Button to Button © 2003 Third Man Records. Dir. Michel Gondry"}],"\n      "]}],["$","p","126",{"children":"$undefined"}],"\n",["$","p","128",{"children":"\n"}],["$","figure","129",{"children":["\n        ",["$","$Ld","1",{"src":"https://cdn.math.computer/v/kosmos2/stripes/frame_000157.png","alt":"","width":800,"height":600,"className":"w-auto h-auto rounded-md mx-auto min-w-[min(640px,100%)]","sizes":"800px","quality":78}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Frame 157 processed through Kosmos-2"}],"\n      "]}],["$","p","130",{"children":"$undefined"}],"\n",["$","p","132",{"children":"\n"}],["$","figure","133",{"children":["\n        ",["$","video","1",{"controls":true,"children":["\n          ",["$","source","1",{"src":"https://cdn.math.computer/v/kosmos2/stripes/output.mp4","type":"video/mp4","children":"$undefined"}],"\n          Your browser does not support the video tag.\n        "]}],"\n        ",["$","figcaption","3",{"className":"text-center text-sm text-gray-600 dark:text-gray-400","children":"Kosmos-2 interpretation of the video. I used this opportunity to handle text-wrapping better"}],"\n      "]}],["$","p","134",{"children":"$undefined"}],"\n",["$","p","136",{"children":["This was a fun video to choose, because it is shot in a video format to mimic the look of time-lapse photography.\nThis means that the frames are relatively static - which should help study the sensitivity of ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"Kosmos-2"}]," qualitatively."]}],"\n",["$","blockquote","138",{"children":["\n",["$","p","1",{"children":"Side-note… the sheer amount of code required to “draw text on an image” in a size-aware manner is wild:"}],"\n"]}],"\n",["$","div","140",{"className":"mb-4","children":["$","div",null,{"className":"bg-neutral-100 dark:bg-neutral-800 rounded-md font-mono","children":["$","pre",null,{"style":{"background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1rem","margin":0,"overflow":"auto","borderRadius":"0.3em","fontSize":"0.75rem"},"children":["$","code",null,{"className":"language-python","style":{"whiteSpace":"pre","background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# ..."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# add answer to the image - use black border on text and white text"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Draw black border first"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    top_left "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["image_w "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["//"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["50"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-9",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-10",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["5"]}],["$","span","code-segment-1-11",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-12",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["*"]}],["$","span","code-segment-1-13",{"className":"$undefined","style":{},"children":[" image_h "]}],["$","span","code-segment-1-14",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["//"]}],["$","span","code-segment-1-15",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-16",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["100"]}],["$","span","code-segment-1-17",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-18",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    fsize "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" np"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["round"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":["image_h "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["/"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["1000"]}],["$","span","code-segment-1-10",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-11",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-12",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["4"]}],["$","span","code-segment-1-13",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-14",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    border_width "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["3"]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    text_width "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["1"]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Calculate maximum width based on font size"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    sample_text "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["\"A\""]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["*"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["50"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":["  "]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Sample text to measure character width"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement10",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["text_width_px"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" text_height_px"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" _ "]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-9",{"className":"$undefined","style":{},"children":[" cv2"]}],["$","span","code-segment-1-10",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-11",{"className":"$undefined","style":{},"children":["getTextSize"]}],["$","span","code-segment-1-12",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-13",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        sample_text"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" \n"]}]]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["FONT_HERSHEY_COMPLEX"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" \n"]}]]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        fsize"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" \n"]}]]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":["        text_width\n"]}],["$","span","code-segement15",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement16",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    avg_char_width "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" text_width_px "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["/"]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["50"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":["  "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Average width per character"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement17",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    max_chars_per_line "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["int"]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":["image_w "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["-"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["2"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-11",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["*"]}],["$","span","code-segment-1-12",{"className":"$undefined","style":{},"children":[" top_left"]}],["$","span","code-segment-1-13",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-14",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-15",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-16",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-17",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-18",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["/"]}],["$","span","code-segment-1-19",{"className":"$undefined","style":{},"children":[" avg_char_width"]}],["$","span","code-segment-1-20",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-21",{"className":"$undefined","style":{},"children":["  "]}],["$","span","code-segment-1-22",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Account for margins"]}],["$","span","code-segment-1-23",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement18",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement19",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# wrap answer text in a box with calculated width"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement20",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    answer_lines "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" wrap"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["answer"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":[" width"]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":["max_chars_per_line"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement21",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    line_height "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" image_h "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["//"]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["20"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":["  "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Pixels between lines"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement22",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement23",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["for"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" i"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" line "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["in"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(95, 38%, 62%)"},"children":["enumerate"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-9",{"className":"$undefined","style":{},"children":["answer_lines"]}],["$","span","code-segment-1-10",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-11",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[":"]}],["$","span","code-segment-1-12",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement24",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Calculate y position for each line, going top-down"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement25",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        y_pos "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" top_left"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["1"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["+"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":[" i "]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["*"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":[" line_height\n"]}]]}],["$","span","code-segement26",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement27",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Draw black border"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement28",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["putText"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement29",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            new_image"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement30",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            line"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement31",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["top_left"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" y_pos"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement32",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["FONT_HERSHEY_COMPLEX"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement33",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            fsize"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement34",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-2",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-10",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-11",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement35",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            border_width"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement36",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["LINE_AA"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement37",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement38",{"className":"$undefined","style":{},"children":["\n"]}],["$","span","code-segement39",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# Draw white text on top"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement40",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["putText"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement41",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            new_image"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement42",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            line"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement43",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["top_left"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" y_pos"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement44",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["FONT_HERSHEY_COMPLEX"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement45",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            fsize"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement46",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-2",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["255"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["255"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["255"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-10",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-11",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement47",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            text_width"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement48",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["            cv2"]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["LINE_AA"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement49",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement50",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# ..."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement51",{"className":"$undefined","style":{},"children":[""]}]]]}]}]}]}],"\n",["$","h2","142",{"children":"Conclusions"}],"\n",["$","blockquote","144",{"children":["\n",["$","p","1",{"children":["The Pipeline: ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"video -> frame -> json -> frame -> video"}],["$","br","2",{"children":"$undefined"}],"\nThe Tools: ",["$","code","4",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"ffmpeg -> kosmos2-api -> python -> ffmpeg"}]]}],"\n"]}],"\n",["$","p","146",{"children":"I’m really happy with these results - given enough hardware, it seems that horizontal scaling is a viable approach."}],"\n",["$","p","148",{"children":["However, I think that ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"(a)"}]," ",["$","code","3",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"batch_size"}]," needs revisiting - as this would make the processes more efficient."]}],"\n",["$","p","150",{"children":"Perhaps there’s an issue in how I am handling batching?"}],"\n",["$","div","152",{"className":"mb-4","children":["$","div",null,{"className":"bg-neutral-100 dark:bg-neutral-800 rounded-md font-mono","children":["$","pre",null,{"style":{"background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","whiteSpace":"pre","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none","padding":"1rem","margin":0,"overflow":"auto","borderRadius":"0.3em","fontSize":"0.75rem"},"children":["$","code",null,{"className":"language-python","style":{"whiteSpace":"pre","background":"transparent","color":"hsl(220, 14%, 71%)","textShadow":"none","fontFamily":"\"Fira Code\", \"Fira Mono\", Menlo, Consolas, \"DejaVu Sans Mono\", monospace","direction":"ltr","textAlign":"left","wordSpacing":"normal","wordBreak":"normal","lineHeight":"1.5","MozTabSize":"2","OTabSize":"2","tabSize":"2","WebkitHyphens":"none","MozHyphens":"none","msHyphens":"none","hyphens":"none"},"children":[false,[["$","span","code-segement0",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# ..."]}],["$","span","code-segment-1-1",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement1",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":[""]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["class"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["Kosmos2API"]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-5",{"className":"$undefined","style":{},"children":["ls"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["."]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":["LitAPI"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[":"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement2",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# ..."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement3",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["def"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["batch"]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-5",{"className":"$undefined","style":{},"children":["self"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" inputs"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[":"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement4",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# comes in as a list of tuples"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement5",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# logger.debug(f\"Type of inputs: {type(inputs)}\")"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement6",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# comes out as a tuple of lists"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement7",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        prompts "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["i"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["0"]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["for"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":[" i "]}],["$","span","code-segment-1-11",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["in"]}],["$","span","code-segment-1-12",{"className":"$undefined","style":{},"children":[" inputs"]}],["$","span","code-segment-1-13",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-14",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement8",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        images "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["="]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["i"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(29, 54%, 61%)"},"children":["1"]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["for"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":[" i "]}],["$","span","code-segment-1-11",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["in"]}],["$","span","code-segment-1-12",{"className":"$undefined","style":{},"children":[" inputs"]}],["$","span","code-segment-1-13",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-14",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement9",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["return"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" prompts"]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":[" images\n"]}]]}],["$","span","code-segement10",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# ..."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement11",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["def"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(207, 82%, 66%)"},"children":["unbatch"]}],["$","span","code-segment-1-4",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["("]}],["$","span","code-segment-1-5",{"className":"$undefined","style":{},"children":["self"]}],["$","span","code-segment-1-6",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[","]}],["$","span","code-segment-1-7",{"className":"$undefined","style":{},"children":[" output"]}],["$","span","code-segment-1-8",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[")"]}],["$","span","code-segment-1-9",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":[":"]}],["$","span","code-segment-1-10",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement12",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["        "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(286, 60%, 67%)"},"children":["return"]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":[" "]}],["$","span","code-segment-1-3",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["["]}],["$","span","code-segment-1-4",{"className":"$undefined","style":{},"children":["output"]}],["$","span","code-segment-1-5",{"className":"token","style":{"color":"hsl(220, 14%, 71%)"},"children":["]"]}],["$","span","code-segment-1-6",{"className":"$undefined","style":{},"children":["  "]}],["$","span","code-segment-1-7",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# align with syntax for MAX_BATCH_SIZE=1"]}],["$","span","code-segment-1-8",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement13",{"className":"$undefined","style":{},"children":[["$","span","code-segment-1-0",{"className":"$undefined","style":{},"children":["    "]}],["$","span","code-segment-1-1",{"className":"token","style":{"color":"hsl(220, 10%, 40%)","fontStyle":"italic"},"children":["# ..."]}],["$","span","code-segment-1-2",{"className":"$undefined","style":{},"children":["\n"]}]]}],["$","span","code-segement14",{"className":"$undefined","style":{},"children":[""]}]]]}]}]}]}],"\n",["$","p","154",{"children":["And ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"(b)"}]," I want to revisit multiple-GPUs-per-server. I think this would be a lot more efficient, especially in combination with batching."]}],"\n",["$","p","156",{"children":["Lastly, ",["$","code","1",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"(c)"}]," Would a more expensive GPU be better for this?\nFor example, could a single ",["$","code","3",{"className":"bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded text-sm","children":"H100"}]," serve the role of many instances?\nWould it be worth the additional cold-start time?"]}],"\n"]}],["$","div",null,{"className":"grid grid-cols-1 md:grid-cols-2 gap-4","children":[["$","figure","0",{"className":"flex flex-col items-center","children":[["$","div",null,{"className":"relative overflow-hidden","children":["$","$Ld",null,{"src":"https://cdn.math.computer/v/kosmos2/stripes/frame_000435.png","alt":"Frame 435 from the White Stripes video The Hardest Button to Button","width":1334,"height":750,"className":"w-max-full","sizes":"1334px","quality":78,"priority":true,"loading":"eager","placeholder":"blur","blurDataURL":"data:image/svg+xml;base64,Cjxzdmcgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciPgogICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMDAwMCIgb2Zmc2V0PSIyMCUiIC8+CiAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDAxIiBvZmZzZXQ9IjUwJSIgLz4KICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iIzAwMDAiIG9mZnNldD0iNzAlIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIGZpbGw9IiMwMDAwIiAvPgogIDxyZWN0IGlkPSJyIiB3aWR0aD0iNzAwIiBoZWlnaHQ9IjQ3NSIgZmlsbD0idXJsKCNnKSIgLz4KICA8YW5pbWF0ZSB4bGluazpocmVmPSIjciIgYXR0cmlidXRlTmFtZT0ieCIgZnJvbT0iLTcwMCIgdG89IjcwMCIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICAvPgo8L3N2Zz4="}]}],["$","figcaption",null,{"className":"mt-2 text-center text-sm text-gray-600 dark:text-gray-400","dangerouslySetInnerHTML":{"__html":"Frame 435 from the White Stripes video The Hardest Button to Button"}}]]}],["$","figure","1",{"className":"flex flex-col items-center","children":[["$","div",null,{"className":"relative overflow-hidden","children":["$","$Ld",null,{"src":"https://cdn.math.computer/v/kosmos2/stripes/frame_000436.png","alt":"Frame 436 from the White Stripes video The Hardest Button to Button","width":1334,"height":750,"className":"w-max-full","sizes":"1334px","quality":78,"priority":false,"loading":"lazy","placeholder":"blur","blurDataURL":"data:image/svg+xml;base64,Cjxzdmcgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciPgogICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMDAwMCIgb2Zmc2V0PSIyMCUiIC8+CiAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDAxIiBvZmZzZXQ9IjUwJSIgLz4KICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iIzAwMDAiIG9mZnNldD0iNzAlIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIGZpbGw9IiMwMDAwIiAvPgogIDxyZWN0IGlkPSJyIiB3aWR0aD0iNzAwIiBoZWlnaHQ9IjQ3NSIgZmlsbD0idXJsKCNnKSIgLz4KICA8YW5pbWF0ZSB4bGluazpocmVmPSIjciIgYXR0cmlidXRlTmFtZT0ieCIgZnJvbT0iLTcwMCIgdG89IjcwMCIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICAvPgo8L3N2Zz4="}]}],["$","figcaption",null,{"className":"mt-2 text-center text-sm text-gray-600 dark:text-gray-400","dangerouslySetInnerHTML":{"__html":"Frame 436 from the White Stripes video The Hardest Button to Button"}}]]}],["$","figure","2",{"className":"flex flex-col items-center","children":[["$","div",null,{"className":"relative overflow-hidden","children":["$","$Ld",null,{"src":"https://cdn.math.computer/v/kosmos2/stripes/frame_000437.png","alt":"Frame 437 from the White Stripes video The Hardest Button to Button","width":1334,"height":750,"className":"w-max-full","sizes":"1334px","quality":78,"priority":false,"loading":"lazy","placeholder":"blur","blurDataURL":"data:image/svg+xml;base64,Cjxzdmcgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciPgogICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMDAwMCIgb2Zmc2V0PSIyMCUiIC8+CiAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDAxIiBvZmZzZXQ9IjUwJSIgLz4KICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iIzAwMDAiIG9mZnNldD0iNzAlIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIGZpbGw9IiMwMDAwIiAvPgogIDxyZWN0IGlkPSJyIiB3aWR0aD0iNzAwIiBoZWlnaHQ9IjQ3NSIgZmlsbD0idXJsKCNnKSIgLz4KICA8YW5pbWF0ZSB4bGluazpocmVmPSIjciIgYXR0cmlidXRlTmFtZT0ieCIgZnJvbT0iLTcwMCIgdG89IjcwMCIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICAvPgo8L3N2Zz4="}]}],["$","figcaption",null,{"className":"mt-2 text-center text-sm text-gray-600 dark:text-gray-400","dangerouslySetInnerHTML":{"__html":"Frame 437 from the White Stripes video The Hardest Button to Button"}}]]}],["$","figure","3",{"className":"flex flex-col items-center","children":[["$","div",null,{"className":"relative overflow-hidden","children":["$","$Ld",null,{"src":"https://cdn.math.computer/v/kosmos2/stripes/frame_000438.png","alt":"Frame 438 from the White Stripes video The Hardest Button to Button","width":1334,"height":750,"className":"w-max-full","sizes":"1334px","quality":78,"priority":false,"loading":"lazy","placeholder":"blur","blurDataURL":"data:image/svg+xml;base64,Cjxzdmcgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciPgogICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMDAwMCIgb2Zmc2V0PSIyMCUiIC8+CiAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDAxIiBvZmZzZXQ9IjUwJSIgLz4KICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iIzAwMDAiIG9mZnNldD0iNzAlIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjcwMCIgaGVpZ2h0PSI0NzUiIGZpbGw9IiMwMDAwIiAvPgogIDxyZWN0IGlkPSJyIiB3aWR0aD0iNzAwIiBoZWlnaHQ9IjQ3NSIgZmlsbD0idXJsKCNnKSIgLz4KICA8YW5pbWF0ZSB4bGluazpocmVmPSIjciIgYXR0cmlidXRlTmFtZT0ieCIgZnJvbT0iLTcwMCIgdG89IjcwMCIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICAvPgo8L3N2Zz4="}]}],["$","figcaption",null,{"className":"mt-2 text-center text-sm text-gray-600 dark:text-gray-400","dangerouslySetInnerHTML":{"__html":"Frame 438 from the White Stripes video The Hardest Button to Button"}}]]}]]}]]}]}]}],["$","nav",null,{"className":"flex justify-between w-full mt-8 mb-4 text-3xl font-bold text-gray-600 dark:text-gray-400 px-4","children":[["$","div",null,{"className":"flex-1 flex justify-start","children":["$","$Lb",null,{"href":"/1/4","className":"hover:underline","children":"←"}]}],["$","div",null,{"className":"flex-1 flex justify-end","children":["$","$Lb",null,{"href":"/1/6","className":"hover:underline","children":"→"}]}]]}]]}]
a:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"MathematicalMichaelx2025"}],["$","meta","3",{"name":"description","content":"Digital Art Log for Dr. Michael Pilosov"}],["$","link","4",{"rel":"icon","href":"/2025/favicon.ico","type":"image/x-icon","sizes":"48x48"}]]
1:null
